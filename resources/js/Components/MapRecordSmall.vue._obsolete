<script setup>
    import { Link } from '@inertiajs/vue3';
    import { computed } from 'vue';
    import { usePage } from '@inertiajs/vue3';

    const props = defineProps({
        record: Object,
        physics: String,
        oldtop: Boolean
    });

    const page = usePage();

    const bestrecordCountry = computed(() => {
        let country = props.record.user?.country ?? props.record.country;
        return (country == 'XX') ? '_404' : country;
    });

    const isMyRecord = computed(() => {
        return page.props.auth.user?.id === props.record.user?.id;
    });

    const getRoute = computed(() => {
        return route(props.record.user ? 'profile.index' : 'profile.mdd', props.record.user ? props.record.user.id : props.record.mdd_id);
    });
</script>

<template>
    <div class="group relative flex items-center gap-2 px-2 py-2 rounded-md transition-all duration-200 hover:bg-white/10 hover:scale-[1.02] hover:shadow-lg">
        <!-- Rank Number - LARGE with pop animation -->
        <div class="font-black text-lg w-7 flex-shrink-0 text-right leading-none transition-all duration-200 group-hover:scale-125 group-hover:translate-x-1 group-hover:mr-1"
             :class="{
                 'text-yellow-400': record.rank === 1 && !record.oldtop,
                 'text-gray-300': record.rank === 2 && !record.oldtop,
                 'text-orange-400': record.rank === 3 && !record.oldtop,
                 'text-gray-400': record.rank > 3 || record.oldtop
             }">
            {{ record.rank }}
        </div>

        <!-- Player Info - Compact but visible -->
        <Link :href="getRoute" class="flex items-center gap-2 min-w-0 flex-1 group/player transition-all duration-200 group-hover:ml-1">
            <img
                v-if="record.user?.profile_photo_path"
                :src="`/storage/${record.user.profile_photo_path}`"
                class="h-7 w-7 rounded-full object-cover"
            />
            <img
                v-else
                :src="`https://www.gravatar.com/avatar/${record.user?.id || record.mdd_id}?s=200&d=mp`"
                class="h-7 w-7 rounded-full"
            />
            <img :src="`/images/flags/${bestrecordCountry}.png`" class="w-5 h-4" onerror="this.src='/images/flags/_404.png'" :title="bestrecordCountry">
            <span class="text-sm font-semibold text-gray-200 truncate group-hover/player:text-blue-400 transition-colors" v-html="q3tohtml(record.user?.name ?? record.name)">
            </span>
        </Link>

        <!-- Time - MASSIVE -->
        <div class="text-right">
            <div class="font-black text-base tabular-nums text-gray-100">{{ formatTime(record.time) }}</div>
        </div>

        <!-- Date & Demo - More visible -->
        <div class="flex items-center gap-2 opacity-70 group-hover:opacity-100 transition-opacity">
            <div class="text-xs text-gray-300 whitespace-nowrap font-mono group-hover:text-gray-200">
                {{ new Date(record.date_set).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }) }}
            </div>
        </div>

        <!-- Left side badges -->
        <div class="absolute -left-1 top-1/2 -translate-y-1/2 text-lg transition-all duration-200 group-hover:scale-110 group-hover:translate-x-0.5">
            <span v-if="record.oldtop && record.rank <= 3">ðŸ‘‘</span>
            <span v-else-if="record.rank === 1 && !record.oldtop">ðŸ¥‡</span>
            <span v-else-if="record.rank === 2 && !record.oldtop">ðŸ¥ˆ</span>
            <span v-else-if="record.rank === 3 && !record.oldtop">ðŸ¥‰</span>
        </div>
    </div>
</template>